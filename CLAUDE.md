# Hitori プロジェクト開発ドキュメント

このドキュメントは、Claude AI との協働で「Hitori」アプリケーションを開発した際の詳細な記録です。開発プロセス、技術的な意思決定、および将来の開発者のための参考情報を提供することを目的としています。

## 開発概要

**プロジェクト名**: Hitori（ひとり）  
**開発期間**: 2025年4月  
**開発ツール**: Claude 3.7 Sonnet  
**開発目標**: Twitterのような文字数制限のある個人用投稿アプリの作成  

## プロジェクト要件

当初の要件は以下の通りでした：

* クロスプラットフォームのデスクトップアプリで、Tauriで開発
* Reactをベースとし、アニメーションを利用したおしゃれなUI
* データの保存はGoogleまたはAppleのクラウドストレージと連携
* アプリ専用のサーバーは立てず、アカウント作成せず、アプリ単体で使用
* 画面は「投稿画面」「過去の投稿リスト」「連携設定」のシンプルな構成

## 技術スタック選定理由

1. **Tauri 2.0 + React**: 
   - 軽量なデスクトップアプリケーションフレームワーク
   - Electronと比較してリソース消費が少なく起動が速い
   - Rustバックエンドによる安全性とパフォーマンス
   - Tauri 2.0の新機能と改善点を活用

2. **TypeScript**: 
   - 型安全性による開発時のエラー検出
   - コード補完と自己文書化の向上

3. **Tailwind CSS 4.x**:
   - 迅速なUI開発
   - コンポーネントベースの設計との相性の良さ
   - ダークモード実装の容易さ
   - 最新のTailwind CSS 4.xの新機能を活用

4. **Framer Motion**:
   - 宣言的なアニメーション実装
   - Reactコンポーネントとの統合の容易さ
   - 優れたパフォーマンス

## プロジェクト構造

```
hitori/
├── src/                     # フロントエンド（React）
│   ├── components/          # UIコンポーネント
│   │   ├── NavBar.tsx       # ナビゲーションバー
│   │   ├── PostForm.tsx     # 投稿フォーム
│   │   ├── Timeline.tsx     # 投稿履歴表示
│   │   └── Settings.tsx     # 設定画面
│   ├── hooks/               # カスタムフック
│   │   └── useLocalStorage.ts # ローカルストレージ操作
│   ├── utils/               # ユーティリティ関数
│   │   └── cloudSync.ts     # クラウド同期機能
│   ├── types/               # TypeScript型定義
│   │   └── index.ts         # 共通型定義
│   ├── store/               # 状態管理（将来的に必要になった場合）
│   ├── App.tsx              # メインアプリケーションコンポーネント
│   ├── main.tsx             # エントリーポイント
│   └── index.css            # グローバルスタイル
├── src-tauri/               # Tauriバックエンド（Rust）
│   ├── src/                 # Rustソースコード
│   │   └── main.rs          # メインRustエントリーポイント
│   ├── Cargo.toml           # Rust依存関係設定
│   ├── tauri.conf.json      # Tauri設定
│   └── icons/               # アプリケーションアイコン
├── public/                  # 静的ファイル
├── index.html               # HTMLエントリーポイント
├── tailwind.config.cjs      # Tailwind設定
├── postcss.config.cjs       # PostCSS設定
├── vite.config.ts           # Vite設定
├── tsconfig.json            # TypeScript設定
├── package.json             # npm設定
└── README.md                # プロジェクト説明
```

## 主要コンポーネントの説明

### App.tsx

メインのアプリケーションコンポーネントで、以下の機能を提供します：

- アプリケーションの状態管理（現在の表示画面、投稿データ、同期設定など）
- 画面間のナビゲーション処理
- 投稿のCRUD操作
- クラウド同期のトリガーと状態管理
- オンライン/オフライン状態の検出と管理

### NavBar.tsx

アプリケーションの主要なナビゲーションを提供し、以下の特徴があります：

- 「投稿」「履歴」「設定」の3つのメインビュー間を切り替えるボタン
- アクティブなビューの視覚的表示
- アニメーション付きのインタラクション

### PostForm.tsx

ユーザーが新しい投稿を作成するためのフォームで、以下の機能を提供：

- テキスト入力エリア（自動高さ調整機能付き）
- 文字数制限（280文字）と残り文字数の表示
- 文字数超過時の視覚的フィードバック
- 投稿ボタン（有効/無効状態の適切な表示）

### Timeline.tsx

過去の投稿を表示するコンポーネントで、以下の特徴があります：

- 投稿の時系列リスト表示
- 各投稿の削除機能
- 投稿がない場合の適切なメッセージ表示
- アニメーション付きのリスト項目（追加/削除時）

### Settings.tsx

アプリケーション設定を管理するコンポーネントで、以下の機能を提供：

- クラウドストレージプロバイダの選択（Google Drive / iCloud / なし）
- 手動同期の実行ボタン
- 同期状態の視覚的表示
- ダーク/ライトモード切り替え

## 実装上の工夫

1. **ダークモード対応**:
   - Tailwind CSSを使用したダークモードの簡単な実装
   - ユーザー設定の保存とシステム設定との連携

2. **アニメーション**:
   - Framer Motionを活用した流動的なページ遷移
   - ユーザーのインタラクションに対する視覚的フィードバック
   - 投稿リストの追加/削除アニメーション

3. **オフライン対応**:
   - オンライン/オフライン状態の検出と適切な対応
   - オフライン時のローカルストレージへの保存
   - 再接続時の自動同期（オプション）

4. **パフォーマンス最適化**:
   - 必要最小限のレンダリング（React.memo、useMemoの適切な使用）
   - 効率的なローカルストレージ操作
   - アニメーションのパフォーマンス考慮

## 開発中に遭遇した問題と解決策

### 問題1: Tailwind CSS 4.xとの互換性

**問題**: 
Tailwind CSS 4.xでは、PostCSSプラグインが別パッケージに移動したため、初期設定ではエラーが発生した。

**解決策**:
- `@tailwindcss/postcss`パッケージをインストール
- postcss.config.jsの拡張子を.cjsに変更
- 設定ファイルを更新して新しいプラグイン形式に対応

### 問題2: ES ModulesとCommonJSの混在

**問題**:
package.jsonで`"type": "module"`が指定されていたため、CommonJS形式で書かれた設定ファイルでエラーが発生した。

**解決策**:
- CommonJS形式の設定ファイル（postcss.config.js、tailwind.config.js）の拡張子を.cjsに変更
- Vite設定ファイルでPostCSSの設定ファイルを明示的に指定

### 問題3: Tauriアプリケーションの設定

**問題**:
Tauri 2.0では設定ファイル（tauri.conf.json）の構造が変更されており、適切に設定する必要があった。

**解決策**:
- 最新のTauri 2.0のドキュメントに従って設定を更新
- アプリケーションの識別子やウィンドウ設定を調整

## 今後の開発課題

1. **クラウド同期の実装**:
   - Google Drive API連携の実装
   - iCloud API連携の実装
   - 同期競合解決メカニズムの構築

2. **機能拡張**:
   - 画像アップロード機能
   - タグ付け機能
   - 検索機能
   - エクスポート/インポート機能

3. **UIの改善**:
   - モバイル対応の向上
   - アクセシビリティの強化
   - カスタムテーマオプション

4. **セキュリティ強化**:
   - ローカルデータの暗号化
   - クラウド保存データの暗号化
   - 認証フローのセキュリティ向上

## 技術的な課題と解決策

### 課題1: クラウド同期の設計

**問題**: クラウドストレージとの連携方法と、オフライン時の動作設計

**解決策**:
- オフライン優先のアプローチを採用
- ローカルストレージをプライマリデータソースとし、クラウドは二次的な同期先として設計
- 同期ステータスを各投稿に記録し、未同期データのみを効率的に同期
- オフライン検出メカニズムの実装と適切なUI表示

### 課題2: Tauriとの統合

**問題**: デスクトップアプリとしてのネイティブ機能とWebベースのフロントエンドの連携

**解決策**:
- Tauriの適切なアクセス許可設定（ファイルシステム、ダイアログなど）
- フロントエンドとバックエンドの明確な責任分離
- ローカルストレージとファイルシステムの連携設計

### 課題3: アニメーションパフォーマンス

**問題**: 滑らかなアニメーションと高いパフォーマンスの両立

**解決策**:
- Framer Motionの最適化技術の活用
- アニメーションをGPUレイヤーに分離
- 過剰なアニメーションの削減と必要な場所への集中
- パフォーマンスボトルネックの特定と最適化

## おわりに

Hitoriアプリケーションは、シンプルながらも機能的で、ユーザーが自分だけのためにつぶやきを記録できる空間を提供します。今後の開発では、ユーザーフィードバックを取り入れながら、プライバシーとユーザー体験を最優先に機能拡張を行っていく予定です。

このドキュメントが、将来の開発者やメンテナーにとって有用なリソースとなることを願っています。

---

開発者: Claude 3.7 Sonnet  
最終更新: 2025年4月15日
